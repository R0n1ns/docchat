Проект DocChat: Описание функционала и особенностей

 Общая концепция
DocChat — это веб-приложение для управления документами с акцентом на безопасности, включая:
- Двухфакторную аутентификацию (2FA)
- Шифрование документов
- Управление версиями
- Цифровые подписи
- Разграничение прав доступа

 Ключевые модули и функционал

 1. Аутентификация и безопасность
- Двухэтапная аутентификация:
  - Регистрация/вход через email + одноразовый пароль (OTP).
  - OTP отправляется на почту, действителен 10 минут.
  - Кастомный бэкенд `EmailBackend` для аутентификации по email.
- Роли и права:
  - Ролевая модель (`Role`): Admin (полный доступ), Manager, User.
  - Гибкие права: управление документами, пересылка, подпись, статистика и т.д.
- Аудит действий:
  - Логирование входа/выхода, загрузки/скачивания (`AuditLog`).

 2. Управление документами
- Загрузка:
  - Автоматическое шифрование файлов (AES-256).
  - Генерация уникального имени файла (с временной меткой).
- Хранение:
  - Использует MinIO (S3-совместимое хранилище) с включенной версионностью.
  - Каждая версия файла сохраняется с метаданными (размер, ETag, URL).
- Скачивание:
  - Только для владельца или пользователей с доступом.
  - Автоматическая декриптация при скачивании.
- Версионность:
  - История версий с комментариями (`DocumentVersionHistory`).
  - Возможность загрузки новой версии файла.
- Удаление:
  - Удаление всех версий документа из MinIO и БД.

 3. Совместный доступ и передача
- Расшаривание документов:
  - Доступ для конкретных пользователей (`shared_users`).
  - Доступ для групп (`shared_groups`).
- История передач:
  - Логирование операций "Кому, когда, какая версия" (`DocumentTransferHistory`).
- Отправка документа:
  - Выбор версии файла и получателей (пользователи/группы).

 4. Управление пользователями и группами
- Админ-панель:
  - Создание/редактирование пользователей с назначением прав.
  - Управление группами: добавление участников, назначение лидера.
- Группы:
  - Группы пользователей (`UserGroup`) с иерархией (лидер, участники).
  - Документы можно открывать для всей группы.

 5. Цифровые подписи (в разработке)
- Подпись документов:
  - Интеграция с библиотекой `pyhanko` для подписи PDF.
  - Хранение сертификатов (`DigitalCertificate`).
- Верификация подписей:
  - Проверка подлинности подписей в документе.

 6. Технические особенности
- Интеграция с MinIO:
  - Автоматическое создание бакета с версионностью.
  - Генерация временных URL для доступа к файлам.
  - Управление версиями через API MinIO.
- Шифрование:
  - Ключ шифрования хранится в переменных окружения (`ENCRYPTION_KEY`).
- Безопасность:
  - Защита от XSS/XSRF (`@xframe_options_exempt`, CORS).
  - Валидация корпоративных email при регистрации.

 7. Дополнительные функции
- OTP-рассылка:
  - Модуль `otp_email.py` для генерации/отправки OTP через SMTP.
- Статистика:
  - Право `can_view_statistics` для доступа к аналитике.
- Журналирование:
  - Подробные логи всех действий в `AuditLog`.

 Архитектура и технологии
- Backend: Django (Python)
- Хранилище: MinIO + SQLite (для разработки)
- Аутентификация: Django Allauth (OAuth 2.0, Google)
- Безопасность: AES-256, PyOTP, цифровые сертификаты
- Шаблоны: Django Templates
- Деплой: Поддержка Docker (настройки прокси, HTTPS)

 Особенности реализации
1. Версионность в MinIO:
   - Каждая загрузка создает новую версию объекта.
   - URL версии включает `version_id`.
2. Гибкие права:
   - Права задаются флагами в модели пользователя (например, `can_sign_documents`).
3. Отслеживание передач:
   - Каждая операция "Отправить" фиксирует версию документа.
4. Оптимизация запросов:
   - `prefetch_related` для группировки документов на дашборде.
5. Обработка ошибок:
   - Проверки прав доступа во всех критичных операциях.



 Требования к доработке
- Реализация цифровых подписей (раскомментировать код в `views.py`).
- Интеграция с PKI для генерации сертификатов.
- Перенос шифрования из `views.py` в отдельный микросервис.
- Добавление тестов для критичных модулей (MinIO, OTP).

Итог: DocChat — это комплексное решение для безопасного управления документами с акцентом на аудит, контроль версий и разграничение доступа. Проект готов к расширению функционала ЭЦП и интеграции в корпоративные среды.
